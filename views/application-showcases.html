{% extends "base.html" %}

{% block title %}
{{ title }} - Dashboard
{% endblock %}

{% block content %}

<div role="main">
  <div id="content" class="container-fluid">
    <div class="container mx-auto p-gutter">
      <nav class="breadcrumb" aria-label="breadcrumb">
        <ol>
          <li class="breadcrumb_item">
            <a class="breadcrumb_link" href="/">{{__('Accueil')}}</a>
          </li>
          <li class="breadcrumb_item">
            <a class="breadcrumb_link" href="/applications" aria-current="page">{{__('Showcases')}}</a>
          </li>
        </ol>
      </nav>
    </div>

    <div class="container mx-auto md:flex p-gutter">
      <div class="w-2/3">
        <h1 class="font-semibold text-3xl mb-1">{{__(title)}}</h1>
        <p class="leading-relaxed lg:w-full">{{__(description)}}</p>
      </div>
    </div>
        
    <div class="container mx-auto md:flex p-gutter">
      <div class="md:w-1/3 md:mr-gutter">
          <button id="filter-toggle" class="bg-primary w-full text-white mb-6 p-3 invisible md:hidden">
            Toggle filters
          </button>
      
          <div class="search-filters">
            {% set facetNames = { tags: 'Tags' } %}
          
            {% for facetId, value in showcases.search_facets %}
            {% if facetId == 'tags' %}
            <section class="mb-6 md:pr-10">
              <h2 class="bg-gray-200 px-4 py-3 border-t border-gray-200 font-bold">{{ __(facetNames[facetId]) }}</h2>
              <ul>
                {% for item in value.items|sort(reverse=true, attribute="count") %}
                {% set itemName = '"' + item.name + '"' %}
                <li class="border-t border-gray-200">
                  <a href="/applications?q={{ facetId }}:{{ itemName }} {{ query.q }}" class="filter-button" aria-label="{{ item.display_name }} ({{ item.count }} results)">
                    {{ item.display_name }}
                    <span class="filter-button_count">{{ item.count }}</span>
                  </a>
                </li>
                {% endfor %}

                {# Link for showing more items from this face #}
                {% if value.items | length > 4 %}
                <li class="border-t border-gray-200">
                  <a href="/applications?facet.limit.{{facetId}}=-1&q={{ query.q }}" class="filter-button text-secondary hover:underline">
                    {{__('Show more')}}
                  </a>
                </li>
                {% endif %}
              </ul>
            </section>
            {% endif %}
            {% endfor %}
          </div>
      </div>

      <div class="md:w-2/3 md:mr-gutter">
        <form action="/applications" method="GET">
          <div class="relative mb-10">
            <input type="text" class="border-2 border-solid border-gray-200 py-4 pl-4 pr-20 text-xl outline-none focus:border-secondary w-full" placeholder={{__('Search showcases')}} name="q" value="{{ query.q }}" autofocus>
      
            <button class="absolute inset-y-0 right-0 w-16 px-4 text-secondary fill-current" type="submit" aria-label="Submit">
              <svg class="w-full h-full"><use xlink:href="#search" /></svg>
            </button>
          </div>
        
          <div class="lg:flex items-center justify-between">
            <h1 class="text-4xl font-semibold text-primary">
              {{ showcases.count }}
              {% if showcases.count == 1 %}
                {{__('dataset found')}}
              {% else %}  
                {{__('datasets found')}}
              {% endif %}
            </h1>
            <div>
              <label for="field-order-by">{{__('Order by')}}:</label>
              <div class="relative">
                <select class="bg-white block appearance-none w-full border-2 border-solid border-gray-200 text-gray-700 py-3 px-4 pr-8 leading-tight focus:outline-none focus:bg-white" id="field-order-by" name="sort" onchange="this.form.submit()">
                  <option value="score:desc" {% if query.sort == "score:desc" %}selected="selected"{% endif %}>{{__('Relevance')}}</option>
                  <option value="title_string:asc" {% if query.sort == "title_string:asc" %}selected="selected"{% endif %}>{{__('Name Ascending')}}</option>
                  <option value="title_string:desc" {% if query.sort == "title_string:desc" %}selected="selected"{% endif %}>{{__('Name Descending')}}</option>
                  <option value="metadata_modified:desc" {% if query.sort == "metadata_modified:desc" %}selected="selected"{% endif %}>{{__('Last Modified')}}</option>
                  <option value="views_recent:desc" {% if query.sort == "views_recent:desc" %}selected="selected"{% endif %}>{{__('Popular')}}</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center py-3 px-4">
                  <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
              </div>
            </div>
          </div>
      
        </form>
       
        <ul class="sm:flex flex-wrap sm:-mx-4 mt-gutter">
          <!-- group -->
          {% for showcase in showcases.results %}
          <li class="sm:w-1/2 lg:w-1/2">
            <a class="flex bg-gray-200 p-4 border-t-4 border-primary my-4 sm:mx-4" href="/applications/single/{{ showcase.id }}">
              <div class="w-24 h-24 mr-4 p-4 flex-shrink-0 flex justify-center bg-gray-300">
                <img class="w-full" src="https://montreal.l3.ckan.io/uploads/showcase/{{ showcase.image_url }}">
              </div>
              <div class="flex flex-col justify-center overflow-hidden">
                <h2 class="font-semibold text-lg">{{ showcase.title }}</h2>
                <p>{{ showcase.description | truncate(100) }}</p>
              </div>
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

{% endblock %}

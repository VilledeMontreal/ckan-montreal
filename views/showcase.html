{% extends "base.html" %}
{% import '_snippets.html' as snippets %}
{% import '_instructions.html' as instructions %}

{% block title %}
{{dataset.title or dataset.name}} - {{__('Dataset')}}
{% endblock %}

{% block content %}
<!-- Data Explorer CSS -->
<link rel="stylesheet" type="text/css" href="/static/stylesheets/dataexplorer/main.0e85ebd4.chunk.css">
<link rel="stylesheet" type="text/css" href="/static/stylesheets/dataexplorer/2.944d0a2f.chunk.css">
<!-- End Data Explorer CSS -->

<section class="container flex  m-auto flex-col md:flex-row px-8"> 
  <div class="w-full  md:w-2/3">
      <div class="pb-4"> 
        <a href="/collections/{{ dataset.groups[0].name}}" class="text-primary font-bold">{{ dataset.groups[0].display_name}}</a>
      </div>
      
      <!-- info -->
      <div>
        <h1 class="text-4xl font-semibold text-zambezi">
          {{ dataset.title or dataset.name }} {{name}}
        </h1>

        <!-- readme section -->
        <div class="container mt-gutter">
          {% if dataset.readmeSnippet or dataset.readmeHtml %}
          <div class="leading-relaxed">{{dataset.readmeHtml|safe}}</div>
        </div>
          {% elif dataset.description %}
            <div class="">
              <div class="markdown-content leading-relaxed">{{dataset.descriptionHtml|safe}}</div>
            </div>
          {% endif %}<!-- end of readme section -->
      </div>
      <!-- end readme section -->
      
      <!-- resources table -->
      <div>
        <table class="table info no-left-padding my-4 text-left w-full">
          <thead>
            <tr>
              <th class="col-xs-1 bg-gray-lighter font-sans font-normal  capitalize text-sm text-gray-900">{{__('Name')}}</th>
              <th class="col-xs-1 pl-2 bg-gray-lighter font-sans font-normal capitalize text-sm text-gray-900 text-center">{{__('Format')}}</th>
              <th class="col-xs-1 pl-2 bg-gray-lighter font-sans font-normal capitalize text-sm text-gray-900 text-center">{{__('Size')}}</th>
              <th class="col-xs-1 pl-2 bg-gray-lighter font-sans font-normal capitalize text-sm text-gray-900 text-center">{{__('Last Changed')}}</th>
              <th class="col-xs-1 pl-2 bg-gray-lighter font-sans font-normal capitalize text-sm text-gray-900 text-center">{{__('Info & Preview')}}</th>
              <th class="col-xs-1 pl-2 bg-gray-lighter font-sans font-normal capitalize text-sm text-gray-900 text-center">{{__('Download')}}</th>
            </tr>
          </thead>
          <tbody>
          {% set cls = cycler("bg-gray-100", "bg-white") %}
          {% for item in dataset.displayResources %}
            <tr class="{{ cls.next() }}">
              <td class="col-xs-1 pl-2 py-2 bg-gray-lighter font-sans  text-sm text-gray"><a href="#{{ item.slug }}">{{ item.resource.title or item.resource.name }}</a></td>
              <td class="col-xs-1 pl-2 py-2 bg-gray-lighter font-sans uppercase text-sm text-gray text-center"> {{ item.resource.format }}</td>
              <td class="col-xs-1 pl-2 py-2 bg-gray-lighter font-sans capitalize text-sm text-gray text-center">{{ item.resource.sizeFormatted or '--' }}</td>
              <td class="col-xs-1 pl-2 py-2 bg-gray-lighter font-sans lowercase text-sm text-gray text-center">{{ __(item.resource.last_modified | formatDateFromNow) }}</td>
              <td class="col-xs-1 pl-2 py-2 bg-gray-lighter font-sans capitalize text-sm text-gray text-center"><a href="#{{item.slug}}"><i class="icon icon-preview text-base hover:text-primary"></i></a></td>
              <td class="col-xs-1 pl-2 py-2 bg-gray-lighter font-sans capitalize text-sm text-gray text-center">
                <a href="{{ item.resource.path }}" onclick="sendGAEvent('{{ dataset.name }}', '{{ item.resource.name }}', '{{ item.resource.format }}')" title="Download file" target="_blank"> <i class="icon icon-download text-base hover:text-primary"></i>  </a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      <!-- end resources table -->
    
      <!-- methodologie section -->
      {% if dataset.methodologie  %}
      <div class="container">
        <h2 class="text-3xl font-semibold mt-gutter mb-2 text-gray-900">{{__('Methodology')}}</h2>
        <div class="markdown-content leading-relaxed">{{dataset.methodologie|processMarkdown|safe}}</div>
      </div>
      {% endif %}
      <!-- end methodologie section -->
      
      <!-- territoire section -->
      {% if dataset.territoire %}
      <div class="container">
        <h2 class="text-3xl font-semibold mt-gutter text-gray-900 mb-2">{{__('Territories')}}</h2>
        {% for t in dataset.territoire %}
          <p class="px-3 py-1">{{territoires[t] | safe or ''}}</p>
        {% endfor %}
      </div>
      {% endif %}
      <!-- end Territories section -->
      </div>
  </div>
  <div class="w-full md:w-1/4 md:ml-12">
    <div data-title="activity-feed">
        <div class="border-solid border-2 border-black mt-4"></div>
      <h3 class="text-4xl font-semibold text-zambezi my-4">{{__('Activity Feed')}}</h3>
    </div>
     {{ activities.feed | safe }}
    {% if activities.limit < 31 %}
    <ul>
      <li><a href="?activity=31" class="text-primary">{{ __('See the whole list')}}</a></li>
    </ul>
    {% endif %}
  </div>
</section>  

<section class="container m-auto flex-col md:flex-row px-8">
      <!-- Keywords section -->
  {% if dataset.keywords %}
  <div class="container">
    <h2 class="text-3xl font-semibold mt-gutter mb-2 text-gray-900 mb-6">{{__('Keywords')}}</h2>
    <div class="flex flex-wrap ">
    {% for t in dataset.keywords %}
      <a href="/search?q=tags:{{t | safe}}" class="px-4 py-2 text-primary font-medium border-2 rounded-full border-primary mr-3 mb-3 lowercase">{{t | safe}}</a>
    {% endfor %}
    </div>
  </div>
  {% endif %}
  <!-- end Keywords section -->

  <!-- Additional Info section -->
    <div class="container">
    <h2 class="text-3xl font-semibold mt-gutter mb-2 text-gray-900">{{__('Additional Info')}}</h2>
    <p class="font-semibold">{{__('Publisher')}}</p>
    {{ dataset.author.name | dump | safe | replace("\"", "") or '--'}}
    <p class="font-semibold">{{__('Update frequency')}}</p>
    {{ __(dataset.update_frequency) or "--"}}
    <p class="font-semibold">{{__('Language')}}</p>
    <p>{{ dataset.language or '--'}}</p>
    <p class="font-semibold">{{__('Geographic area')}}</p>
    <p>{{ dataset.ext_spatial or '--'}}</p>
    <p class="font-semibold">{{__('Last updated')}}</p>
    <p>{{ __(dataset.metadata_modified | formatDateFromNow)}}</p>
    <p class="font-semibold">{{__('Created')}}</p>
    <p><span id="#date">{{ dataset.metadata_created | formatDate }}</span></p>
    <p>{{ dataset.license_url }}</p>
    <!-- end Additional Info section -->

    <!-- data files (downloads) -->
    {% include "./partials/resource-display.njk" %}
    <!-- info end -->
  </div>
</section>

<!-- Disqus -->
<div class="container mx-auto p-gutter">
  <div id="disqus_thread"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function toggleApi(i) {
    const el = document.getElementById(`data-api-info-${i}`)
    if (el.style.display === "none") {
      el.style.display = "block"
    } else {  el.style.display = "none" }
  } 

  function copyFromEl(i, el)  {
    const val = document.getElementById(`${el}-${i}`)
    val.select()
    val.setSelectionRange(0, 99999)
    document.execCommand("copy")
  }

  function sendGAEvent(datasetName, resourceName, resourceFormat) {
    gtag('event', "download", {
      'event_category': datasetName,
      'event_label': resourceName,
      'value':resourceFormat,
      'non_interaction': true
    });
  }
</script>
<script>
  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

  var disqus_config = function () {
  this.page.url = window.location.href;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = window.location.href; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://ckan-next-gen.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<script type="text/javascript" src="/static/js/dataexplorer/runtime~main.a8a9905a.js"></script>
<script type="text/javascript" src="/static/js/dataexplorer/2.34264b03.chunk.js"></script>
<script type="text/javascript" src="/static/js/dataexplorer/main.b5b7b9e9.chunk.js"></script>

{% endblock %}

(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1002:function(e,a,t){"use strict";t.r(a);var r=t(517),n=t(4),c=t.n(n),i=t(82),s=t.n(i),o=(t(246),t(238)),d=t(152),l=t(503),u=t(504),p=function(e){var a=f(e);return a.resources&&a.resources.forEach(function(e){delete e.data,delete e._values}),a.views&&a.views.forEach(function(e){e.resources&&e.resources.forEach(function(e){delete e.data,delete e._values})}),a},f=function(e){return JSON.parse(JSON.stringify(e))},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"DATA_VIEW_CHART_BUILDER_ACTION":var t=f(e);return t=t.map(function(e){return"simple"===e.datapackage.views[0].specType&&(e.datapackage.views[0]=a.payload),e}),Object.assign(f(e),t);case"DATA_VIEW_MAP_BUILDER_ACTION":var r=f(e);return r=r.map(function(e){return"tabularmap"===e.datapackage.views[0].specType&&(e.datapackage.views[0]=a.payload),e}),Object.assign(f(e),r);case"SELECT_TAB":case"FETCH_DATA_BEGIN":case"FETCH_DATA_SUCCESS":case"FETCH_DATA_FAILURE":return a.payload.widgets;default:return e}},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"DATAPACKAGE_LOAD":return a.payload.datapackage;default:return e}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch((arguments.length>1?arguments[1]:void 0).type){case"FILTER_UI_ACTION":default:return e}},w=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&arguments[1];var e=arguments.length>2?arguments[2]:void 0;try{var a=f(e);delete a.serializedState;var t=p(a.datapackage),r=a.widgets.map(function(e){return e.datapackage=p(e.datapackage),e.loading=!1,e});return JSON.stringify(Object.assign(a,{datapackage:t,widgets:r}))}catch(n){return console.warn(n),{}}},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;return{widgets:m(e.widgets,a),datapackage:v(e.datapackage,a),datastoreFilters:g(e.datastoreFilters,a),serializedState:w(e.serializedState,a,e)}},b={datastoreFilters:{},datapackage:{},widgets:[],serializedState:{}};function k(e){return Object(d.createStore)(y,Object.assign({},b,e),Object(l.composeWithDevTools)(Object(d.applyMiddleware)(u.a)))}var h=t(137),E=t(505),O=t(509),N=t.n(O),A=t(510),x=function(e){var a=e.datapackage.views;return c.a.createElement(N.a,{loaded:!e.loading,style:{position:"relative"}},c.a.createElement("div",null,a.map(function(e){return c.a.createElement(A.DataView,{key:Math.random(),datapackage:{views:[e]}})})))},S=["archiver","schema","shareLink","iframeText"],T=function(e){var a=function(e){if(e.length<=1500)return e;var a=JSON.parse(e);return a.datapackage.resources.forEach(function(e){for(var a in S)e[S[a]]&&delete e[S[a]]}),JSON.stringify(a)}(e.serializedState),t="localhost:4000/data-explorer?explorer=".concat(a),r='<iframe src="localhost:4000/data-explorer?explorer='.concat(a,'" />'),n=t.length<2e3,i=function(e){var a=document.createElement("textarea");a.value=e,a.setAttribute("readonly",""),a.style={position:"absolute",left:"-9999px"},document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)};return c.a.createElement("div",null,n&&c.a.createElement("div",{className:"dx-share-container"},c.a.createElement("div",{className:"m-4"},c.a.createElement("input",{id:"share-link",className:"border-solid border-4 border-gray-600 w-1/2 px-2",value:t}),c.a.createElement("a",{href:"#/",id:"copy-share-link",className:"m-4",onClick:function(){i(t)}},c.a.createElement("i",null,"copy share link"))),c.a.createElement("div",{className:"m-4"},c.a.createElement("input",{id:"embed",className:"border-solid border-4 border-gray-600 px-2 w-1/2",value:r}),c.a.createElement("a",{href:"#/",id:"copy-share-link",className:"m-4",onClick:function(){i(r)}},c.a.createElement("i",null,"copy embed text")))),!n&&c.a.createElement("p",null,"No share link available"))},_=t(515),C=t(516),j=t(242),J=t(35),D=t.n(J),I=t(334),B=t(433);function F(e){try{return JSON.parse(e)}catch(a){return e}}var L=function(e){var a,t,r;return D.a.async(function(n){for(;;)switch(n.prev=n.next){case 0:return a=F(e),t=["csv","tsv","dsv","xls","xlsx"],n.prev=2,n.next=5,D.a.awrap(I.Dataset.load(a));case 5:return r=n.sent,n.next=8,D.a.awrap(Promise.all(r.resources.map(function(e){var a,r,n,c,i,s,o,d;return D.a.async(function(l){for(;;)switch(l.prev=l.next){case 0:if("FileInline"!==e.displayName){l.next=4;break}return l.abrupt("return");case 4:if(!e.descriptor.api||!e.descriptor.api.includes("datastore_search")){l.next=24;break}return l.next=7,D.a.awrap(fetch(e.descriptor.api));case 7:if((a=l.sent).ok){l.next=11;break}return e.descriptor.unavailable=!0,l.abrupt("return");case 11:return l.next=13,D.a.awrap(a.json());case 13:return r=l.sent,e.descriptor.data=r.result.records,e.descriptor.totalrowcount=r.result.total,n=Object(I.open)({data:e.descriptor.data.map(Object.values),format:"csv"}),c=Object.keys(e.descriptor.data[0]),n.descriptor.data=[c].concat(n.descriptor.data),l.next=21,D.a.awrap(n.addSchema());case 21:e.descriptor.schema=n.descriptor.schema,l.next=67;break;case 24:if("FileRemote"!==e.displayName||!t.includes(e.descriptor.format)){l.next=43;break}return l.prev=25,l.next=28,D.a.awrap(e.rows({size:100,keyed:!0}));case 28:return i=l.sent,l.next=31,D.a.awrap(B(i));case 31:return(s=l.sent).length>0?e.descriptor.data=s:e.descriptor.unavailable=!0,l.next=35,D.a.awrap(e.addSchema());case 35:l.next=41;break;case 37:l.prev=37,l.t0=l.catch(25),console.warn(l.t0),e.descriptor.unavailable=!0;case 41:l.next=67;break;case 43:if(!e.descriptor.format.toLowerCase().includes("json")){l.next=62;break}return l.next=46,D.a.awrap(fetch(e.descriptor.path));case 46:if((o=l.sent).ok){l.next=50;break}return e.descriptor.unavailable=!0,l.abrupt("return");case 50:return l.next=52,D.a.awrap(o.json());case 52:if(d=l.sent,!["Feature","FeatureCollection","Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeometryCollection"].includes(d.type)){l.next=58;break}e.descriptor.data=d,l.next=60;break;case 58:return e.descriptor.unavailable=!0,l.abrupt("return");case 60:l.next=67;break;case 62:if("pdf"!==e.descriptor.format.toLowerCase()){l.next=66;break}return l.abrupt("return");case 66:e.descriptor.unavailable=!0;case 67:case"end":return l.stop()}},null,null,[[25,37]])})));case 8:return n.abrupt("return",r.descriptor);case 11:return n.prev=11,n.t0=n.catch(2),console.warn("Failed to load a Dataset from provided datapackage id\n"+n.t0),n.abrupt("return",a);case 15:case"end":return n.stop()}},null,null,[[2,11]])},U=t(237),V=function(e){return{type:"SELECT_TAB",payload:Object(h.a)({},e)}},M=function(e){return{type:"DATAPACKAGE_LOAD",payload:Object(h.a)({},e)}},P=function(e){return{type:"FETCH_DATA_BEGIN",payload:Object(h.a)({},e)}},R=function(e){return{type:"FETCH_DATA_SUCCESS",payload:Object(h.a)({},e)}},z=Object(o.b)(function(e){return Object(h.a)({},e)},function(e){return{filterUIAction:function(a){return e(function(e){return function(a,t){var r,n,c,i,s,o;return D.a.async(function(d){for(;;)switch(d.prev=d.next){case 0:return r=JSON.parse(JSON.stringify(t().datapackage)),n=JSON.parse(JSON.stringify(e)),(c=Object.assign(r,{resources:[n]})).resources[0].datastore_active&&delete c.resources[0].data,a(M({datapackage:c})),i=JSON.parse(JSON.stringify(t().widgets)).map(function(e){return e.loading=!0,e}),a(P({widgets:i})),r=JSON.parse(JSON.stringify(t().datapackage)),d.next=10,D.a.awrap(L(r));case 10:s=d.sent,a(M({datapackage:s})),o=JSON.parse(JSON.stringify(t().widgets)).map(function(e){return e.datapackage.views=e.datapackage.views.map(function(e){return Object(U.compileView)(e,s)}),e.loading=!1,e}),a(R({widgets:o}));case 14:case"end":return d.stop()}})}}(a))},fetchDataAction:function(a){return e(function(e){return function(a){var t,r,n,c;return D.a.async(function(i){for(;;)switch(i.prev=i.next){case 0:return t=JSON.parse(JSON.stringify(e.widgets)).map(function(e){return e.loading=!0,e}),a(P({widgets:t})),r=JSON.parse(JSON.stringify(e.datapackage)),i.next=5,D.a.awrap(L(r));case 5:n=i.sent,a(M({datapackage:n})),c=JSON.parse(JSON.stringify(e.widgets)).map(function(e){return e.datapackage.views=e.datapackage.views.map(function(e){return Object(U.compileView)(e,n)}),e}),a(R({widgets:c}));case 9:case"end":return i.stop()}})}}(a))},dataViewBuilderAction:function(a){return e(function(e){return function(a){var t;"simple"===e.specType?t="DATA_VIEW_CHART_BUILDER_ACTION":"tabularmap"===e.specType&&(t="DATA_VIEW_MAP_BUILDER_ACTION"),a({type:t,payload:e})}}(a))},selectTabAction:function(a){return e(function(e){return function(a,t){var r=JSON.parse(JSON.stringify(t().widgets));r.forEach(function(a,t){r[t].active=!1,a.name===e&&(r[t].active=!0)}),a(V({widgets:r}))}}(a))}}})(function(e){Object(n.useEffect)(function(){var a={datapackage:e.datapackage,widgets:e.widgets};e.fetchDataAction(a)},[]);var a,t=e.widgets.find(function(e){return e.active}),r=t?t.name:e.widgets[0].name,i=e.widgets.map(function(e){return c.a.createElement(j.TabLink,{to:e.name,className:"mr-4"},e.name)}),s=e.widgets.map(function(a){return c.a.createElement(j.TabContent,{for:a.name},c.a.createElement("div",{className:"container flex py-6"},c.a.createElement("div",{className:"w-3/4 py-3 mr-4"},c.a.createElement(x,a)),c.a.createElement("div",{className:"w-1/4"},c.a.createElement("div",{className:"w-full"},c.a.createElement("div",{className:"p-4 mr-4"},"simple"===a.datapackage.views[0].specType?c.a.createElement(_.ChartBuilder,{view:a.datapackage.views[0],dataViewBuilderAction:e.dataViewBuilderAction}):"","tabularmap"===a.datapackage.views[0].specType?c.a.createElement(C.MapBuilder,{view:a.datapackage.views[0],dataViewBuilderAction:e.dataViewBuilderAction}):"")))))});return c.a.createElement("div",{className:"ml-6"},c.a.createElement("div",{className:"container py-4"},c.a.createElement("div",{className:"datastore-query-builder"},e.datapackage.resources[0].datastore_active?c.a.createElement(E.QueryBuilder,{resource:(a=e.datapackage,a?a.resources[0]:{}),filterBuilderAction:e.filterUIAction}):"")),c.a.createElement(j.Tabs,{renderActiveTabContentOnly:!0,handleSelect:function(a){e.selectTabAction(a)},selectedTab:r},i,s),c.a.createElement(T,{serializedState:e.serializedState}))}),H=function(e){var a,t;if("string"===typeof e.datapackage)try{a=JSON.parse(e.datapackage)}catch(n){a={},console.warn("Invalid datapackage",n)}else"object"===typeof e.datapackage&&(a=e.datapackage);try{t=JSON.parse(JSON.stringify(a.views)),delete a.views}catch(i){console.log("No views set on datapackage")}var r=e.widgets?e.widgets:function(e){var a={table:"Table",tabularmap:"Map",map:"Map",simple:"Chart"};return e.map(function(e,t){return{active:0===t,name:a[e.specType],datapackage:{views:[e]}}})}(t);return c.a.createElement(o.a,{store:k({widgets:r,datapackage:a})},c.a.createElement(z,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var W=document.getElementsByClassName("data-explorer"),G=!0,K=!1,q=void 0;try{for(var Q,$=W[Symbol.iterator]();!(G=(Q=$.next()).done);G=!0){var X=Q.value;try{var Y=JSON.parse(X.getAttribute("data-datapackage")),Z=Y.datapackage,ee=Object(r.a)(Y,["datapackage"]);s.a.render(c.a.createElement(H,Object.assign({datapackage:Z},ee)),document.getElementById(X.id))}catch(ae){console.warn("Failed to render data-explorer",ae)}}}catch(te){K=!0,q=te}finally{try{G||null==$.return||$.return()}finally{if(K)throw q}}"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},246:function(e,a,t){},501:function(e,a){},524:function(e,a,t){e.exports=t(1002)},576:function(e,a){},577:function(e,a){},690:function(e,a){},692:function(e,a){},722:function(e,a){},723:function(e,a){},905:function(e,a,t){var r={"./geojson.json":480,"./table-schema.json":906,"./topojson.json":481};function n(e){var a=c(e);return t(a)}function c(e){if(!t.o(r,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=c,e.exports=n,n.id=905},993:function(e,a){},994:function(e,a){},998:function(e,a){},999:function(e,a){}},[[524,1,2]]]);
//# sourceMappingURL=main.5309eb33.chunk.js.map